{% extends 'admin_index.html' %}
{% block content %}
<style>
    body {
        background-color: #55b5e8;
    }

    .container {
        max-width: 1100px;
        margin-top: 50px;
    }

    .product-card {
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #fff;
        padding: 15px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .carousel-inner img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 10px;
    }

    .thumbnails {
        display: flex;
        justify-content: center;
        margin-top: 8px;
        gap: 5px;
    }

    .thumbnails img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        cursor: pointer;
        border: 2px solid transparent;
        border-radius: 5px;
        transition: border 0.2s ease;
    }

    .thumbnails img.active {
        border: 2px solid #00477d;
    }

    .product-info {
        margin-top: 10px;
    }

    .btn-edit, .btn-delete {
        margin-right: 5px;
    }

    .btn-edit {
        background-color: #00477d;
        color: #fff;
    }

    .btn-edit:hover {
        background-color: #00365e;
    }

    .btn-delete {
        background-color: #dc3545;
        color: #fff;
    }

    .btn-delete:hover {
        background-color: #a71d2a;
    }

    .category-select {
        margin-bottom: 25px;
    }

    .badge-container {
        margin-bottom: 8px;
    }

    .badge {
        border-radius: 20px;
        padding: 5px 10px;
        font-size: 0.9rem;
        display: inline-block;
        margin-right: 6px;
        font-weight: 500;
    }

    .badge-pet {
        background-color: #e7f1ff;
        color: #00477d;
    }

    .badge-sub {
        background-color: #ffe8e8;
        color: #c00;
    }

    .badge-cat {
        background-color: #e8ffe8;
        color: #006600;
    }
</style>

<div class="container">
    <h3 class="mb-4" style="color:#00477d">View Products by Category</h3>

    <!-- Category Selection -->
    <div class="category-select">
        <label class="form-label fw-bold" style="color:#00477d">Select Product Category</label>
        <select id="categorySelect" class="form-select">
            <option value="">-- All Categories --</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if selected_category and selected_category|add:'0' == cat.id|add:'0' %}selected{% endif %}>
                    {{ cat.productcategory }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Products Grid -->
    <div class="row g-4">
        {% if products %}
            {% for product in products %}
                <div class="col-md-4">
                    <div class="product-card">
                        <!-- Carousel -->
                        {% if product.images.all %}
                        <div id="carousel{{ product.id }}" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                {% for img in product.images.all %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <img src="{{ img.image.url }}" class="d-block w-100" alt="{{ product.name }}">
                                </div>
                                {% endfor %}
                            </div>

                            {% if product.images.count > 1 %}
                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ product.id }}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ product.id }}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                            {% endif %}
                        </div>

                        <!-- Thumbnails -->
                        {% if product.images.count > 1 %}
                        <div class="thumbnails">
                            {% for img in product.images.all %}
                            <img src="{{ img.image.url }}" data-bs-target="#carousel{{ product.id }}" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}">
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% else %}
                        <img src="https://via.placeholder.com/300x200?text=No+Image" class="w-100 mb-2" alt="No Image">
                        {% endif %}

                        <!-- Product Info -->
                        <div class="product-info">
                            <div class="badge-container">
                                {% if product.productcategory %}
                                    <span class="badge badge-cat">üè∑Ô∏è {{ product.productcategory.productcategory }}</span>
                                {% endif %}
                                {% if product.petcategory %}
                                    <span class="badge badge-pet">üêæ {{ product.petcategory.petcategory }}</span>
                                {% endif %}
                                {% if product.petsubcategory %}
                                    <span class="badge badge-sub">üêæ {{ product.petsubcategory.petsubcategory }}</span>
                                {% endif %}
                            </div>

                            <h5 class="text-primary">{{ product.name }}</h5>
                            <p class="small">{{ product.description|truncatewords:20 }}</p>
                            <p><strong>üí∞ Price:</strong> ‚Çπ{{ product.price }}</p>
                            <p><strong>üì¶ Stock:</strong> {{ product.stock }}</p>
                            <div class="mt-2">
                                <a href="{% url 'edit_products' %}?id={{product.id}}" class="btn btn-edit btn-sm">Edit</a>
                                <form method="POST" action="{% url 'delete_products' %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                    {% csrf_token %}
                                    <input type="hidden" name="product_id" value="{{ product.id }}">
                                    <button type="submit" class="btn btn-delete btn-sm">Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="col-12 text-center text-muted">
                <h5>No products found in this category.</h5>
            </div>
        {% endif %}
    </div>
</div>

<script>
document.getElementById('categorySelect').addEventListener('change', function() {
    const categoryId = this.value;
    if (categoryId) {
        window.location.href = `?category=${categoryId}`;
    } else {
        window.location.href = window.location.pathname;
    }
});

// Thumbnail click functionality
document.querySelectorAll('.thumbnails img').forEach((thumb) => {
    thumb.addEventListener('click', function() {
        const carousel = document.querySelector(this.dataset.bsTarget);
        const slideTo = parseInt(this.dataset.bsSlideTo);
        const carouselInstance = bootstrap.Carousel.getInstance(carousel);
        carouselInstance.to(slideTo);

        this.parentElement.querySelectorAll('img').forEach(img => img.classList.remove('active'));
        this.classList.add('active');
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
