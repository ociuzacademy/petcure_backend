{% extends 'admin_index.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center text-primary fw-bold mb-4">ðŸšš Assign Delivery Agents</h2>

  {% if orders %}
  <div class="table-responsive shadow-sm rounded-4 p-3 bg-white">
    <table class="table table-striped align-middle text-center mb-0">
      <thead class="table-primary">
        <tr>
          <th>Order ID</th>
          <th>User</th>
          <th>Total Amount</th>
          <th>Payment Method</th>
          <th>Assign Agent</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td class="fw-semibold">#{{ order.id }}</td>
          <td>{{ order.user.username }}</td>
          <td>â‚¹{{ order.total_amount }}</td>
          <td>
            {% if order.payment_set.first %}
              {{ order.payment_set.first.payment_method|title }}
            {% else %}
              <span class="text-muted">N/A</span>
            {% endif %}
          </td>
          <td>
            <form method="POST" action="{% url 'assign_delivery_agent' order.id %}">
              {% csrf_token %}
              <div class="d-flex align-items-center justify-content-center gap-2">
                <select name="delivery_agent_id" class="form-select w-auto" required>
                  <option value="" disabled selected>Select Agent</option>
                  {% for agent in delivery_agents %}
                  <option value="{{ agent.id }}">{{ agent.username }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-success btn-sm px-3" type="submit">Assign</button>
              </div>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="text-center mt-5">
    <h5 class="text-muted">No pending orders to assign.</h5>
  </div>
  {% endif %}
</div>
{% endblock %}
